Screen2 As screen:

    Gallery4_1 As gallery.galleryVertical:
        DelayItemLoading: =true
        Height: =197
        Items: =Filter('public.Medical_Center_Usuario',id_sede= _varSede.id)
        Layout: =Layout.Vertical
        LoadingSpinner: =LoadingSpinner.Data
        TemplateSize: =92
        Width: =323
        X: =212
        Y: =571
        ZIndex: =7

        Label5_1 As label:
            OnSelect: =Select(Parent)
            Text: =ThisItem.Especialidad
            Width: =117
            ZIndex: =1

        Label11_2 As label:
            Height: =45
            OnSelect: =Select(Parent)
            Text: =Sum(Filter('public.Medical_Center_Pagos',DateValue(Text(Fecha,"dd/mm/yyyy")) >= DateValue(Text( datePiker_Caja_Registro_4.SelectedDate,"dd/mm/yyyy")) && DateValue(Text(Fecha,"dd/mm/yyyy")) <= DateValue(Text( datePiker_Caja_Registro_3.SelectedDate,"dd/mm/yyyy")),id_sede= _varSede.id,Usuario=ThisItem.Correo),Monto)
            Width: =98
            Y: =40
            ZIndex: =2

        Label5_4 As label:
            OnSelect: =Select(Parent)
            Text: =ThisItem.Correo
            Width: =117
            X: =140
            ZIndex: =3

    Label21 As label:
        BorderThickness: =2
        Text: =Sum(Gallery4_2.AllItems,Label11_3.Text)
        X: =1216
        Y: =236
        ZIndex: =9

    Label18 As label:
        Text: ="Hombre"
        X: =1010
        Y: =73
        ZIndex: =11

    Label18_1 As label:
        Text: ="Mujer"
        X: =1010
        Y: =130
        ZIndex: =12

    Label18_3 As label:
        Text: |
            =Value(CountRows(Filter(galCajaResumen2.AllItems,Label11_4.Text="Masculino"))/If(CountRows(galCajaResumen2.AllItems)=0,1,CountRows(galCajaResumen2.AllItems)))*100 &" %"
        X: =1140
        Y: =73
        ZIndex: =13

    Label18_4 As label:
        Text: =Value(CountRows(Filter(galCajaResumen2.AllItems,Label11_4.Text="Femenino"))/If(CountRows(galCajaResumen2.AllItems)=0,1,CountRows(galCajaResumen2.AllItems)))*100 &" %"
        X: =1140
        Y: =130
        ZIndex: =14

    Label18_5 As label:
        Text: ="Venta"
        X: =990
        Y: =236
        ZIndex: =16

    Label18_6 As label:
        Text: =Sum(Filter('public.Medical_Center_Pagos',id_sede= _varSede.id),Monto)
        X: =1140
        Y: =236
        ZIndex: =17

    "galCajaResumen As gallery.'BrowseLayout_Vertical_TwoTextOneImageVariant_ver4.0'":
        DelayItemLoading: =true
        Height: =197
        Items: |-
            =Filter('public.Medical_Center_time_log',id_sede = _varSede.id,
            DateValue(Text(Fecha,"dd/mm/yyyy")) >= DateValue(Text( datePiker_Caja_Registro_4.SelectedDate,"dd/mm/yyyy")) && DateValue(Text(Fecha,"dd/mm/yyyy")) <= DateValue(Text( datePiker_Caja_Registro_3.SelectedDate,"dd/mm/yyyy")))
        Layout: =Layout.Vertical
        LoadingSpinner: =LoadingSpinner.Data
        TemplatePadding: =0
        TemplateSize: =Min(160, Self.Height - 60)
        Width: =381
        ZIndex: =20

        Title5_4 As label:
            Height: =33
            OnSelect: =Select(Parent)
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Text: =ThisItem.Tiempo
            VerticalAlign: =VerticalAlign.Top
            Width: =140
            Y: =44
            ZIndex: =2

        Subtitle1_2 As label:
            Height: =26
            OnSelect: =Select(Parent)
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Text: =Value(Left(ThisItem.Tiempo,1)*60) + Minute(ThisItem.Tiempo)  + Round(Value(Right(ThisItem.Tiempo,2)/60),2)
            VerticalAlign: =VerticalAlign.Top
            Width: =259
            X: =Title5_4.X
            Y: =110
            ZIndex: =3

        Separator2_5 As rectangle:
            Height: =1
            OnSelect: =Select(Parent)
            Width: =Parent.TemplateWidth
            Y: =Parent.TemplateHeight - 1
            ZIndex: =5

    galCajaResumen2 As gallery.galleryVertical:
        BorderThickness: =2
        DelayItemLoading: =true
        Height: =197
        Items: |
            =Distinct(Filter('public.Medical_Center_Counter',etapa="Atención Medica",estado="Atendido",id_sede = _varSede.id,DateValue(Text(fecha,"dd/mm/yyyy")) >= DateValue(Text( datePiker_Caja_Registro_4.SelectedDate,"dd/mm/yyyy")) && DateValue(Text(fecha,"dd/mm/yyyy")) <= DateValue(Text( datePiker_Caja_Registro_3.SelectedDate,"dd/mm/yyyy"))),DNI_Paciente)
        Layout: =Layout.Vertical
        LoadingSpinner: =LoadingSpinner.Data
        TemplateSize: =92
        Width: =140
        X: =426
        ZIndex: =21

        Label5_6 As label:
            OnSelect: =Select(Parent)
            Text: |
                =ThisItem.Value
            Width: =117
            ZIndex: =1

        Label11_4 As label:
            Height: =45
            OnSelect: =Select(Parent)
            Text: =LookUp('public.Medical_Center_Historial_Principal',DNI_CI=ThisItem.Value,Sexo)
            Width: =98
            Y: =40
            ZIndex: =2

    galCajaResumen3 As gallery.galleryVertical:
        DelayItemLoading: =true
        Height: =197
        Items: =Distinct(Gallery4_1.AllItems,Especialidad)
        Layout: =Layout.Vertical
        LoadingSpinner: =LoadingSpinner.Data
        TemplateSize: =92
        Width: =267
        Y: =214
        ZIndex: =22

        Label5_5 As label:
            OnSelect: =Select(Parent)
            Text: |-
                =ThisItem.Value &" (" &
                Round(
                  IfError(  Value(
                        
                            Sum(Filter(Gallery4_1.AllItems,Especialidad=ThisItem.Value),Label11_2.Text))
                            /
                            
                            Value(Sum(Gallery4_2.AllItems,Label11_3.Text)),0)*100,2) &"%"
                
                 /*Round(
                     Value(
                         If(
                             IsBlank(Sum(Filter(Gallery4_1.AllItems;Especialidad=ThisItem.Value);Label11_2.Text))
                             ;0;
                             Sum(Filter(Gallery4_1.AllItems;Especialidad=ThisItem.Value);Label11_2.Text)))
                             /
                             If(Value(Sum(Gallery4_2.AllItems;Label11_3.Text))=0;1;
                             Value(Sum(Gallery4_2.AllItems;Label11_3.Text)))*100
                             
                             ;2) &"%"  &")"*/
            Width: =222
            ZIndex: =1

        Label18_2 As label:
            OnSelect: =Select(Parent)
            Text: |
                =Round(
                  IfError(  Value(
                        
                            Sum(Filter(Gallery4_1.AllItems,Especialidad=ThisItem.Value),Label11_2.Text))
                            /
                            
                            Value(Sum(Gallery4_2.AllItems,Label11_3.Text)),0)*100,2) &"%"
            Width: =117
            Y: =52
            ZIndex: =3

    Gallery4_2 As gallery.galleryVertical:
        DelayItemLoading: =true
        Height: =197
        Items: =Distinct(Gallery4_1.AllItems,Especialidad)
        Layout: =Layout.Vertical
        LoadingSpinner: =LoadingSpinner.Data
        TemplateSize: =92
        Width: =267
        X: =557
        Y: =571
        ZIndex: =23

        Label5_2 As label:
            OnSelect: =Select(Parent)
            Text: =ThisItem.Value
            Width: =222
            ZIndex: =1

        Label11_3 As label:
            Height: =45
            OnSelect: =Select(Parent)
            Text: =If(IsBlank(Sum(Filter(Gallery4_1.AllItems,Especialidad=ThisItem.Value),Label11_2.Text)),0,Sum(Filter(Gallery4_1.AllItems,Especialidad=ThisItem.Value),Label11_2.Text))
            Width: =78
            Y: =40
            ZIndex: =2

    galCajaResumen4 As gallery.galleryVertical:
        DelayItemLoading: =true
        Height: =197
        Items: =Distinct(Filter('public.Medical_Center_Pagos',DateValue(Text(Fecha,"dd/mm/yyyy")) >= DateValue(Text( datePiker_Caja_Registro_4.SelectedDate,"dd/mm/yyyy")) && DateValue(Text(Fecha,"dd/mm/yyyy")) <= DateValue(Text( datePiker_Caja_Registro_3.SelectedDate,"dd/mm/yyyy")),id_sede= _varSede.id),Nombre_Doctor)
        Layout: =Layout.Vertical
        LoadingSpinner: =LoadingSpinner.Data
        TemplateSize: =114
        Width: =148
        X: =60
        Y: =571
        ZIndex: =24

        Label5 As label:
            OnSelect: =Select(Parent)
            Text: =ThisItem.Value
            Width: =138
            ZIndex: =1

        Label11 As label:
            OnSelect: =Select(Parent)
            Text: =Sum(Filter('public.Medical_Center_Pagos',id_sede= _varSede.id,Nombre_Doctor=ThisItem.Value,DateValue(Text(Fecha,"dd/mm/yyyy")) >= DateValue(Text( datePiker_Caja_Registro_4.SelectedDate,"dd/mm/yyyy")) && DateValue(Text(Fecha,"dd/mm/yyyy")) <= DateValue(Text( datePiker_Caja_Registro_3.SelectedDate,"dd/mm/yyyy"))),Monto)
            Width: =130
            Y: =51
            ZIndex: =2

    conAction_1 As groupContainer.horizontalAutoLayoutContainer:
        Height: =24
        LayoutDirection: =LayoutDirection.Vertical
        LayoutGap: =10
        LayoutJustifyContent: =LayoutJustifyContent.Center
        LayoutMode: =LayoutMode.Auto
        PaddingLeft: =5
        PaddingRight: =5
        Visible: |-
            =//!conCrearHistoriaP.Visible
            true
        Width: =200
        X: =815
        Y: =20
        ZIndex: =25

        btnPasarCaja_1 As button:
            BorderColor: =ColorFondoBoton
            Color: =ColorFondoBoton
            DisabledBorderColor: =RGBA(116, 116, 116, 1)
            DisplayMode: |+
                =/**If(Text(Today(),"dd/mm/yyyy")<>Text(ThisItem.fecha_cita,"dd/mm/yyyy") Or LookUp('public.Medical_Center_Counter',id_Ticket=ThisItem.id,etapa)="Atención Medica" || LookUp('public.Medical_Center_Counter',id_Ticket=ThisItem.id,etapa)="Caja" || LookUp('public.Medical_Center_Counter',id_Ticket=ThisItem.id,etapa)="Triaje" ,DisplayMode.Disabled,DisplayMode.Edit)**/
                With(
                    {
                        lookupResult: LookUp('public.Medical_Center_Counter',id_Ticket = ThisItem.id,etapa)
                    },
                    If(
                        getUser.Rol = "Caja" ||  getUser.Rol = "Triaje" ||  getUser.Rol = "Doctor" || ThisItem.caja_finalizada = true || lookupResult = "Caja" || Text(Today(), "dd/mm/yyyy") <> Text(ThisItem.fecha_cita, "dd/mm/yyyy") ,
                        DisplayMode.Disabled,
                        DisplayMode.Edit
                    )
                )
                
                
                
                
            Fill: =RGBA(255, 255, 255, 1)
            FocusedBorderColor: =btnPasarCaja_1.BorderColor
            Font: =Font.'Segoe UI'
            FontWeight: =FontWeight.Bold
            HoverBorderColor: =ColorFade(btnPasarCaja_1.BorderColor, 20%)
            HoverColor: |-
                =ColorValue("#26495B")
            HoverFill: =RGBA(255, 255, 255, 1)
            OnSelect: |+
                =
                Set(
                    AtencionSelected,
                    gal_Citas_Pendientes.Selected
                );
                If(
                    LookUp(
                        'public.Medical_Center_Historial_Principal',
                        DNI_CI = AtencionSelected.id_Pacientes_DNI,
                        DNI_CI
                    ) = AtencionSelected.id_Pacientes_DNI,
                  If(getUser.Rol= "Administrador",  Navigate(Caja) & Refresh('public.Medical_Center_Counter'),Navigate('Atencion Cliente Dashboard'));
                  
                    Set(
                        varCaja,
                        false
                    )
                    
                    
                );
                If(IsEmpty(Filter('public.Medical_Center_Counter',id_Ticket=AtencionSelected.id)),
                Patch('public.Medical_Center_Counter',Defaults('public.Medical_Center_Counter'),
                {
                id_Ticket:AtencionSelected.id,  
                  estado:"En Cola",
                  etapa:"Caja",
                  usuario:ThisItem.Doctor,
                   id_sede : _varSede.id  ,
                  fecha:gal_Citas_Pendientes.Selected.fecha_cita,
                  fecha_texto:Text(gal_Citas_Pendientes.Selected.fecha_cita,"yymmdd"),
                  Paciente:gal_Citas_Pendientes.Selected.Nombre_Paciente,
                  DNI_Paciente:gal_Citas_Pendientes.Selected.id_Pacientes_DNI,
                  Servicio:gal_Citas_Pendientes.Selected.Servicio,
                  Alerta:true
                }),
                Patch('public.Medical_Center_Counter',LookUp('public.Medical_Center_Counter',id_Ticket=AtencionSelected.id),
                {
                  estado:"En Cola",
                  etapa:"Caja"
                })
                );
                
                
                
                If(IsEmpty(Filter('public.MC_Servicios_Paciente',id_ticket=ThisItem.id,id_servicio=ThisItem.id_servicio)),
                Patch('public.MC_Servicios_Paciente',Defaults('public.MC_Servicios_Paciente'),{
                    id:GUID(),
                    id_ticket:ThisItem.id,
                    id_dni_paciente:ThisItem.id_Pacientes_DNI,
                    id_sede:_varSede.id,
                    id_especialidad:LookUp('public.Medical_Center_S&E_Relacion',id=ThisItem.id_especialidad_x_sede,id_especialidad),
                    id_servicio:ThisItem.id_servicio,
                    id_doctor:getUser.id,
                    fecha_registro:Now()
                })
                );
                
                Patch('public.Medical_Center_Ticket',LookUp('public.Medical_Center_Ticket',id=AtencionSelected.id_Pacientes_DNI),{Estatus:"En Atención"})
                
                
                
            PressedBorderColor: =ColorFondoBoton
            PressedColor: =ColorFondoBoton
            PressedFill: =RGBA(255, 255, 255, 1)
            RadiusBottomLeft: =8
            RadiusBottomRight: =8
            RadiusTopLeft: =8
            RadiusTopRight: =8
            Size: =12
            Text: ="PASAR A CAJA"
            Width: =190
            X: =1136
            Y: =120
            ZIndex: =1

        btnPasarAtencion_2 As button:
            BorderColor: =ColorFondoBoton
            Color: =ColorFondoBoton
            DisabledBorderColor: =RGBA(116, 116, 116, 1)
            DisplayMode: |-
                =
                With(
                    {
                        lookupResult: LookUp('public.Medical_Center_Counter',id_Ticket = ThisItem.id,etapa)
                    },
                    If(
                       getUser.Rol = "Triaje" ||getUser.Rol = "Caja" ||  getUser.Rol = "Doctor" And Text(Today(), "dd/mm/yyyy") <> Text(ThisItem.fecha_cita, "dd/mm/yyyy") || ThisItem.cita_finalizada = true || ThisItem.triaje_finalizada = true || lookupResult = "Triaje",
                        DisplayMode.Disabled,
                        DisplayMode.Edit
                    )
                )
            Fill: =RGBA(255, 255, 255, 1)
            FocusedBorderColor: =btnPasarAtencion_2.BorderColor
            Font: =Font.'Segoe UI'
            FontWeight: =FontWeight.Bold
            HoverBorderColor: =ColorFade(btnPasarAtencion_2.BorderColor, 20%)
            HoverColor: |-
                =ColorValue("#26495B")
            HoverFill: =RGBA(255, 255, 255, 1)
            OnSelect: |-
                =
                If(IsEmpty(Filter('public.Medical_Center_Counter',id_Ticket=ThisItem.id)),
                Patch('public.Medical_Center_Counter',Defaults('public.Medical_Center_Counter'),
                { 
                id_Ticket:ThisItem.id,  
                  estado:"En Cola",
                  etapa:"Triaje",
                  usuario:ThisItem.Doctor,
                    id_sede : _varSede.id  ,
                  fecha:gal_Citas_Pendientes.Selected.fecha_cita,
                  fecha_texto:Text(ThisItem.fecha_cita,"yymmdd"),
                  Paciente:gal_Citas_Pendientes.Selected.Nombre_Paciente,
                  DNI_Paciente:gal_Citas_Pendientes.Selected.id_Pacientes_DNI,
                  Servicio:gal_Citas_Pendientes.Selected.Servicio,
                  Alerta:true
                }),
                Patch('public.Medical_Center_Counter',LookUp('public.Medical_Center_Counter',id_Ticket=ThisItem.id),
                {  
                  estado:"En Cola",
                  etapa:"Triaje"
                })
                );
                
                Patch('public.Medical_Center_Ticket',LookUp('public.Medical_Center_Ticket',id=ThisItem.id_Pacientes_DNI),{Estatus:"En Atención"});
                
                
                
                If(
                    LookUp(
                        'public.Medical_Center_Historial_Principal',
                        DNI_CI = AtencionSelected.id_Pacientes_DNI,
                        DNI_CI
                    ) = AtencionSelected.id_Pacientes_DNI,
                  If(getUser.Rol= "Administrador",   Navigate(Triaje_Dashboard) & Refresh('public.Medical_Center_Counter'),Navigate('Atencion Cliente Dashboard')) , ""  
                );
            PressedBorderColor: =ColorFondoBoton
            PressedColor: =ColorFondoBoton
            PressedFill: =RGBA(255, 255, 255, 1)
            RadiusBottomLeft: =8
            RadiusBottomRight: =8
            RadiusTopLeft: =8
            RadiusTopRight: =8
            Size: =12
            Text: ="PASAR A TRIAJE"
            Width: =190
            X: =1136
            Y: =120
            ZIndex: =2

        btnReagendar_1 As button:
            BorderColor: =ColorFondoBoton
            Color: =ColorFondoBoton
            DisplayMode: =If(getUser.Rol = "Asistente" || getUser.Rol = "Administrador", DisplayMode.Disabled, DisplayMode.Edit)
            Fill: =RGBA(255, 255, 255, 1)
            Font: =Font.'Segoe UI'
            HoverColor: =ColorFondoBoton
            HoverFill: =RGBA(255, 255, 255, 1)
            OnSelect: |-
                =UpdateContext({CitaLlamada:true});
                Set(varAgendarCitaNew,false);
                Set(varAgendarCitaEdit,true);
            PressedBorderColor: =ColorFondoBoton
            PressedColor: =ColorFondoBoton
            PressedFill: =RGBA(255, 255, 255, 1)
            Size: =12
            Text: ="REAGENDAR CITA"
            Visible: =false//REVISAR OCULTAR REAGENDAMIENTO
            Width: =190
            X: =805
            Y: =53
            ZIndex: =3

        btnPasarAtencion_3 As button:
            BorderColor: =ColorFondoBoton
            Color: =ColorFondoBoton
            DisabledBorderColor: =RGBA(116, 116, 116, 1)
            DisplayMode: |-
                =With(
                    {
                        lookupResult: LookUp('public.Medical_Center_Counter',id_Ticket = ThisItem.id,etapa)
                    },
                    If( getUser.Rol = "Caja" || 
                        getUser.Rol = "Triaje" || getUser.Rol = "Doctor" And
                        Text(Today(), "dd/mm/yyyy") <> Text(ThisItem.fecha_cita, "dd/mm/yyyy") || ThisItem.cita_finalizada = true || ThisItem.triaje_finalizada = true || lookupResult = "Atención Medica",
                        DisplayMode.Disabled,
                        DisplayMode.Edit
                    )
                )
            Fill: =RGBA(255, 255, 255, 1)
            FocusedBorderColor: =btnPasarAtencion_3.BorderColor
            Font: =Font.'Segoe UI'
            FontWeight: =FontWeight.Bold
            HoverBorderColor: =ColorFade(btnPasarAtencion_3.BorderColor, 20%)
            HoverColor: |-
                =ColorValue("#26495B")
            HoverFill: =RGBA(255, 255, 255, 1)
            OnSelect: |-
                =
                
                If(IsEmpty(Filter('public.Medical_Center_Counter',id_Ticket=ThisItem.id)),
                Patch('public.Medical_Center_Counter',Defaults('public.Medical_Center_Counter'),
                { 
                id_Ticket:ThisItem.id,  
                  estado:"En Cola",
                  etapa:"Atención Medica",
                  usuario:ThisItem.Doctor,
                    id_sede : _varSede.id  ,
                  fecha:gal_Citas_Pendientes.Selected.fecha_cita,
                  fecha_texto:Text(ThisItem.fecha_cita,"yymmdd"),
                  Paciente:gal_Citas_Pendientes.Selected.Nombre_Paciente,
                  DNI_Paciente:gal_Citas_Pendientes.Selected.id_Pacientes_DNI,
                  Servicio:gal_Citas_Pendientes.Selected.Servicio,
                  Alerta:true
                }),
                Patch('public.Medical_Center_Counter',LookUp('public.Medical_Center_Counter',id_Ticket=ThisItem.id),
                { 
                  estado:"En Cola",
                  etapa:"Atención Medica"
                })
                );
                
                Patch('public.Medical_Center_Ticket',LookUp('public.Medical_Center_Ticket',id=ThisItem.id_Pacientes_DNI),{Estatus:"En Atención"});
                
                
                
                If(
                    LookUp(
                        'public.Medical_Center_Historial_Principal',
                        DNI_CI = AtencionSelected.id_Pacientes_DNI,
                        DNI_CI
                    ) = AtencionSelected.id_Pacientes_DNI,
                  If(getUser.Rol= "Administrador",  Navigate('Consulta Medica Dashboard') & Refresh('public.Medical_Center_Counter'),Navigate('Atencion Cliente Dashboard'));
                  ""    
                );
            PressedBorderColor: =ColorFondoBoton
            PressedColor: =ColorFondoBoton
            PressedFill: =RGBA(255, 255, 255, 1)
            RadiusBottomLeft: =8
            RadiusBottomRight: =8
            RadiusTopLeft: =8
            RadiusTopRight: =8
            Size: =12
            Text: ="PASAR ATENCIÓN"
            Width: =190
            X: =1136
            Y: =120
            ZIndex: =4

